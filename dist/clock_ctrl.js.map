{"version":3,"sources":["../src/clock_ctrl.js"],"names":["guid","s4","Math","floor","random","toString","substring","syncMaps","map_list","k","map_ctrl","hasOwnProperty","push","length","combos","i","j","m","A","B","sync","d3","_","MetricsPanelCtrl","appEvents","cmap_opts","interpolateInferno","interpolatePlasma","interpolateRainbow","interpolateCool","heatOpts","radius","minOpacity","maxZoom","max","blur","panelDefaults","ClockCtrl","$scope","$injector","myMap","data","dataLinScale","timeSrv","min","mapId","String","get","panel","metric","cmap","nbins","defaults","dashboard","events","on","onInitEditMode","bind","onPanelTeardown","render","data_","minLat","maxLat","minLon","maxLon","polylines","polyline","undefined","rows","position","Geohash","decode","lat","lng","lastLineHasData","value","hash","timestamp","remove","center","find","point","L","map","zoomControl","attributionControl","count","chart_id","histogram","plot","a","marker","LatLng","title","bindPopup","markers","addLayer","clean","cid","select","aggregate","cluster","val","childMarkers","getAllChildMarkers","total","parseInt","options","avg","round","navg","divIcon","html","className","iconSize","values","d","extent","scaleLinear","range","formatVal","format","hist","wrap","$","margin","top","right","bottom","left","width","height","g","append","attr","x","rangeRound","svg","domain","thresholds","ticks","bins","set_y_domain","y","div","style","bar","selectAll","enter","x0","set_mouseover","transition","duration","x1","set_mouseout","set_fill","c","gradient","set_height","fix","setView","fitBounds","tiles","tileLayer","attribution","subdomains","addTo","markerClusterGroup","iconCreateFunction","spiderfyOnMaxZoom","singleMarkerMode","addEditorTab","$timeout","cancel","nextTickPromise","scope","elem","templateUrl","base32","geohash","bounds","latMin","sw","lonMin","latMax","ne","lonMax","lon","toFixed","log","LN10","Number","Error","toLowerCase","evenBit","chr","charAt","idx","indexOf","n","bitN","lonMid","latMid"],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["// leaflet stuff\nimport './external/leaflet.js';\nimport './external/leaflet-markercluster.js';\n//import './leaflet-heat.js';\nimport './external/leaflet-sync.js';\n\n// d3 stuff\nimport * as d3 from './external/d3.min.js';\nimport './external/d3-color.min.js';\n\n//import './external/d3-interpolate.min.js';\n//import './external/d3-scale-chromatic.min.js';\nimport _ from 'lodash';\n//import moment from 'moment';\n\nimport './css/clock-panel.css!';\nimport './css/leaflet.css!';\n\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport appEvents from 'app/core/app_events';\n\nvar map_ctrl = {};\n\nvar cmap_opts = {\n    \"inferno\": d3.interpolateInferno,\n    \"plasma\": d3.interpolatePlasma,\n    \"rainbow\": d3.interpolateRainbow,\n    \"cool\": d3.interpolateCool,\n    //\"BrBG\": d3.interpolateBrBG,\n}\n\nfunction guid() {\n    function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n}\n\nvar heatOpts = {\n    radius:20,\n    minOpacity: 0,\n    maxZoom: 18,\n    max: 600,\n    blur: 15,\n}\n\nconst panelDefaults = {\n    'metric': \"undefined\",\n    'heatOpts': heatOpts,\n    'cmap': \"rainbow\",\n    'nbins': 10\n};\n\n\nfunction syncMaps(){\n    var map_list = [];\n    for (var k in map_ctrl) {\n        if (map_ctrl.hasOwnProperty(k)) {\n            if (map_ctrl[k]['count']>0) {\n                map_list.push(map_ctrl[k]['map']);\n            }\n        }\n    }\n    if (map_list.length>1) {\n        var combos = [];\n        for (var i = 0; i < map_list.length; i++)\n            for (var j = i + 1; j < map_list.length; j++)\n                combos.push([map_list[i], map_list[j]]);\n\n        //console.log(\"Combos: \", combos.length);\n        for (var m in combos){\n            var A = combos[m][0];\n            var B = combos[m][1];\n            A.sync(B);\n            B.sync(A);\n        }\n    }\n}\n\n\nexport class ClockCtrl extends MetricsPanelCtrl {\n\n    constructor($scope, $injector) {\n        var myMap,\n            data = [],\n            dataLinScale,\n            timeSrv,\n            min, max,\n            mapId = \"map-\" + String(guid());\n\n        super($scope, $injector);\n        timeSrv = $injector.get('timeSrv');\n\n        this.panel.mapId = mapId;\n\n        var metric =    this.panel.metric,\n            cmap =      cmap_opts[this.panel.cmap],\n            nbins =     this.panel.nbins,\n            heatOpts =  this.panel.heatOpts;\n\n        _.defaults(this.panel, panelDefaults);\n\n        const dashboard = this.dashboard;\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('panel-initialized', this.render.bind(this));\n\n        this.events.on('data-received', function (data_) {\n            data = [];\n            var minLat = 90;\n            var maxLat = -90;\n            var minLon = 180;\n            var maxLon = -180;\n\n            var polylines = [];\n            var polyline = [];\n\n            if (data_[0]!=undefined && data_[0].rows!=undefined){\n                for (var i = 0; i < data_[0].rows.length; i++) {\n                    const position = data_[0].rows[i][1] ?\n                        Geohash.decode(data_[0].rows[i][1]) :\n                        null;\n                    if (position) {\n                        minLat = Math.min(minLat, position.lat);\n                        minLon = Math.min(minLon, position.lng);\n                        maxLat = Math.max(maxLat, position.lat);\n                        maxLon = Math.max(maxLon, position.lng);\n                        polyline.push(position);\n                    } else {\n                        if (lastLineHasData) {\n                            polylines.push(polyline);\n                            polyline = [];\n                            lastLineHasData = false;\n                        }\n                    }\n                    data.push({\n                        value: data_[0].rows[i][2],\n                        hash: data_[0].rows[i][1],\n                        position: position,\n                        timestamp: data_[0].rows[i][0]\n                    });\n                }\n            }\n\n            if (myMap) {\n                myMap.remove();\n            }\n\n            var center = data.find(point => point.position);\n            center = center ? center.position : [0, 0];\n\n            myMap = L.map(\"div#\" + mapId, {\n                zoomControl: false,\n                attributionControl:false\n            });\n\n            map_ctrl[mapId] = {\n                map: myMap,\n                count: data.length,\n                chart_id: \"svg#hist-\"+mapId,\n            };\n\n            histogram.plot(mapId);\n\n            for (var i = 0; i < data.length; i++) {\n                const a = data[i];\n                const marker = L.marker(new L.LatLng(a.position.lat, a.position.lng, ), {\n                    title: a.value,\n                    value: a.value\n                });\n                marker.bindPopup(a.value);\n                markers.addLayer(marker);\n            }\n\n            myMap.addLayer(markers);\n            syncMaps();\n\n        });\n\n    var histogram = {\n\n        clean: function(){\n            const cid = map_ctrl[mapId]['chart_id'] + \" > *\";\n            d3.select(cid).remove();\n        },\n\n        aggregate: function(cluster) {\n            let val = 0,\n                childMarkers = cluster.getAllChildMarkers(), // Store in local variable to avoid having to execute it many times.\n                total = childMarkers.length;\n            for (i = 0; i < total; i++) {\n                val = val + parseInt(childMarkers[i].options.value)\n            }\n            let avg = val / total;\n            avg = Math.round(avg * 10) / 10;\n            let navg = (avg-min)/max;\n            return new L.divIcon({\n                html: \"<div style='background-color: \" + cmap(navg) + \"'><span>\" + avg + \"</span></div>\",\n                className: ' marker-cluster',\n                iconSize: new L.point(40, 40)\n            })\n        },\n\n        plot: function(){\n\n            histogram.clean();\n\n            let values = data.map(function(d) { return d.value;});\n\n            [min, max] = d3.extent(values);\n            values = values.map(function(d) { return (d-min)/(max-min);});\n            dataLinScale = d3.scaleLinear().range([min, max]);\n\n            let formatVal = d3.format(\",.00f\");\n            let hist = d3.select(map_ctrl[mapId]['chart_id']);\n            let wrap = $(\"div#wrap-hist-\"+mapId);\n\n            let margin = {top: 3, right: 3, bottom: 3, left: 3},\n                width = + wrap.width() - margin.left - margin.right,\n                height = + wrap.height() - margin.top - margin.bottom,\n                g = hist.append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n            let x = d3.scaleLinear().rangeRound([0, width]);\n\n            histogram.svg = d3.histogram()\n                .domain(x.domain())\n                .thresholds(x.ticks(nbins));\n\n            let bins = histogram.svg(values);\n\n            let set_y_domain = function(d){\n                return d.length;\n            };\n\n            let y = d3.scaleLinear()\n                .domain([0, d3.max(bins, set_y_domain)])\n                .range([height, 0]);\n\n            let div = d3.select(\"div#tooltip-hist-\"+mapId)\n                .attr(\"class\", \"tooltip\")\n                .style(\"opacity\", 0);\n\n            let bar = g.selectAll(\"bar\")\n                .data(bins)\n                .enter().append(\"g\")\n                .attr(\"class\", \"bar\")\n                .attr(\"transform\", function(d) { return \"translate(\" + x(d.x0) + \",\" + y(d.length) + \")\";  });\n\n            let set_mouseover = function(d) {\n                div.transition()\n                    .duration(50)\n                    .style(\"opacity\", .9)\n                    .style(\"background-color\", \"black\");\n                div.html(\"[\" + formatVal(dataLinScale(d.x0)) +  \"-\" + formatVal(dataLinScale(d.x1))+ \"]\");\n            }\n\n            let set_mouseout = function(d) {\n                div.transition()\n                    .duration(50)\n                    .style(\"opacity\", 0);\n            }\n\n            let set_fill = function(d) {\n                var c = cmap(d.x0);\n                heatOpts.gradient[d.x1] = c;\n                return c;\n            };\n\n            let set_height = function(d) {\n                return height - y(d.length);\n            };\n\n            bar.append(\"rect\")\n                .attr(\"x\", 0)\n                .attr(\"width\", x(bins[0].x1) - x(bins[0].x0) - 1)\n                .attr(\"height\", set_height)\n                .attr(\"fill\", set_fill)\n                .on(\"mouseover\", set_mouseover)\n                .on(\"mouseout\", set_mouseout);\n\n            let fix = 0.000000000001;\n\n            if (data[0]!=undefined){\n                myMap.setView(new L.LatLng(40.730610, -73.935242), 18);\n            } else {\n                myMap.setView(new L.LatLng(center[0], center[1]), 18);\n            }\n\n            myMap.fitBounds([\n                [minLat + fix, minLon + fix],\n                [maxLat + fix, maxLon + fix]\n            ]);\n\n            var tiles = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {\n                attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n                subdomains: 'abcd',\n                maxZoom: 20\n            }).addTo(myMap);\n\n            var markers = L.markerClusterGroup( {\n                iconCreateFunction: histogram.aggregate,\n                spiderfyOnMaxZoom: false,\n                singleMarkerMode: true\n            });\n        }\n    }\n\n    };\n\n    onInitEditMode() {\n        this.addEditorTab( 'Options', 'public/plugins/grafana-map-panel/editor.html', 2);\n    }\n\n    onPanelTeardown() {\n        this.$timeout.cancel(this.nextTickPromise);\n        //console.log(\"teardown: \", this);\n        map_ctrl[mapId]['map'].remove();\n        histogram.clean();\n        delete map_ctrl[mapId];\n        syncMaps();\n    }\n\n    link(scope, elem) {\n        this.events.on('render', () => {\n            //const $panelContainer = elem.find('.panel-container');\n        });\n    }\n}\n\nClockCtrl.templateUrl = 'module.html';\n\nvar Geohash = {};\n\n/* (Geohash-specific) Base32 map */\nGeohash.base32 = '0123456789bcdefghjkmnpqrstuvwxyz';\n\nGeohash.decode = function (geohash) {\n    var bounds = Geohash.bounds(geohash); // <-- the hard work\n    // now just determine the centre of the cell...\n\n    var latMin = bounds.sw.lat,\n        lonMin = bounds.sw.lng;\n    var latMax = bounds.ne.lat,\n        lonMax = bounds.ne.lng;\n\n    // cell centre\n    var lat = (latMin + latMax) / 2;\n    var lon = (lonMin + lonMax) / 2;\n\n    // round to close to centre without excessive precision: ⌊2-log10(Δ°)⌋ decimal places\n    lat = lat.toFixed(Math.floor(2 - Math.log(latMax - latMin) / Math.LN10));\n    lon = lon.toFixed(Math.floor(2 - Math.log(lonMax - lonMin) / Math.LN10));\n\n    return {\n        lat: Number(lat),\n        lng: Number(lon)\n    };\n};\n\nGeohash.bounds = function (geohash) {\n    if (geohash.length === 0) throw new Error('Invalid geohash');\n\n    geohash = geohash.toLowerCase();\n\n    var evenBit = true;\n    var latMin = -90,\n        latMax = 90;\n    var lonMin = -180,\n        lonMax = 180;\n\n    for (var i = 0; i < geohash.length; i++) {\n        var chr = geohash.charAt(i);\n        var idx = Geohash.base32.indexOf(chr);\n        if (idx == -1) throw new Error('Invalid geohash');\n        for (var n = 4; n >= 0; n--) {\n            var bitN = (idx >> n) & 1;\n            if (evenBit) {\n                // longitude\n                var lonMid = (lonMin + lonMax) / 2;\n                if (bitN == 1) {\n                    lonMin = lonMid;\n                } else {\n                    lonMax = lonMid;\n                }\n            } else {\n                // latitude\n                var latMid = (latMin + latMax) / 2;\n                if (bitN == 1) {\n                    latMin = latMid;\n                } else {\n                    latMax = latMid;\n                }\n            }\n            evenBit = !evenBit;\n        }\n    }\n\n    var bounds = {\n        sw: {\n            lat: latMin,\n            lng: lonMin\n        },\n        ne: {\n            lat: latMax,\n            lng: lonMax\n        }\n    };\n\n    return bounds;\n};\n"]}