{"version":3,"sources":["../src/clock_ctrl.js"],"names":["guid","s4","Math","floor","random","toString","substring","cleanPrevChart","mapId","cid","map_ctrl","d3","select","remove","loadGradient","gradient","ret","values","c0","v","c1","c2","c","syncMaps","map_list","k","hasOwnProperty","push","length","combos","i","j","m","A","B","sync","_","MetricsPanelCtrl","appEvents","cmap_opts","interpolateInferno","interpolatePlasma","interpolateRainbow","heatOpts","radius","minOpacity","maxZoom","max","blur","panelDefaults","ClockCtrl","$scope","$injector","myMap","coords","highlightedMarker","timeSrv","get","panel","maxDataPoints","String","colorbarId","colorbar_","defaults","dashboard","metric","cmap","nbins","events","on","onInitEditMode","bind","onPanelTeardown","render","data","minLat","maxLat","minLon","maxLon","polylines","polyline","lastLineHasData","undefined","rows","position","Geohash","decode","min","lat","lng","value","hash","timestamp","center","find","point","L","map","zoomControl","attributionControl","count","chart_id","d","range","randomBates","extent","realValues","scaleLinear","formatVal","format","hist","wrap","$","margin","top","right","bottom","left","width","height","g","append","attr","x","rangeRound","histogram","domain","thresholds","ticks","bins","set_y_domain","y","div","style","bar","selectAll","enter","x0","set_mouseover","transition","duration","html","x1","event","pageX","pageY","set_mouseout","set_fill","set_height","fix","setView","LatLng","fitBounds","tiles","tileLayer","attribution","subdomains","addTo","aggregateFun","cluster","val","childMarkers","getAllChildMarkers","total","parseInt","options","avg","round","navg","divIcon","className","iconSize","markers","markerClusterGroup","iconCreateFunction","spiderfyOnMaxZoom","singleMarkerMode","a","marker","title","bindPopup","addLayer","addEditorTab","$timeout","cancel","nextTickPromise","scope","elem","templateUrl","base32","geohash","bounds","latMin","sw","lonMin","latMax","ne","lonMax","lon","toFixed","log","LN10","Number","Error","toLowerCase","evenBit","chr","charAt","idx","indexOf","n","bitN","lonMid","latMid"],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["import './leaflet.js';\nimport './leaflet-markercluster.js';\n\nimport _ from 'lodash';\n//import moment from 'moment';\nimport './css/clock-panel.css!';\nimport './leaflet.css!';\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport appEvents from 'app/core/app_events';\n\nimport './leaflet-heat.js';\nimport './leaflet-sync.js';\n\nimport * as d3 from './external/d3.min.js';\nimport './external/d3-color.min.js';\n\n//import * as h337 from './external/heatmap.min.js';\n\nvar map_ctrl = {};\n\nvar cmap_opts = {\n    \"inferno\": d3.interpolateInferno,\n    \"plasma\": d3.interpolatePlasma,\n    \"rainbow\": d3.interpolateRainbow,\n}\n\nfunction guid() {\n    function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n}\n\nfunction cleanPrevChart(mapId){\n    var cid = map_ctrl[mapId]['chart_id'] + \" > *\";\n    d3.select(cid).remove();\n}\n\nfunction loadGradient(gradient){\n    var ret = {};\n    var values = [\n        gradient.c0.v,\n        gradient.c1.v,\n        gradient.c2.v,\n    ]\n    ret[values[0]] = gradient.c0.c;\n    ret[values[1]] = gradient.c1.c;\n    ret[values[2]] = gradient.c2.c;\n    return ret;\n}\n\nvar heatOpts = {\n    radius:20,\n    minOpacity: 0,\n    maxZoom: 18,\n    max: 600,\n    blur: 15,\n    gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}\n}\n\nconst panelDefaults = {\n    'metric': \"undefined\",\n    'heatOpts': heatOpts,\n    'cmap': \"rainbow\",\n    'nbins': 10\n};\n\n//import './realworld-10000.js';\n//import {h337} from './heatmap.js'\n//import {HeatmapOverlay} from './leaflet-heatmap.js';\n//\n\nfunction syncMaps(){\n    //console.log(map_ctrl);\n    var map_list = [];\n    for (var k in map_ctrl) {\n        if (map_ctrl.hasOwnProperty(k)) {\n            if (map_ctrl[k]['count']>0) {\n                map_list.push(map_ctrl[k]['map']);\n            }\n        }\n    }\n    //console.log(map_list);\n\n    if (map_list.length>1) {\n        var combos = [];\n        for (var i = 0; i < map_list.length; i++)\n            for (var j = i + 1; j < map_list.length; j++)\n                combos.push([map_list[i], map_list[j]]);\n\n        //console.log(\"Combos: \", combos.length);\n        for (var m in combos){\n            var A = combos[m][0];\n            var B = combos[m][1];\n            A.sync(B);\n            B.sync(A);\n        }\n    }\n\n}\n\n\nexport class ClockCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector) {\n\n        var myMap;\n        var coords = [];\n        var highlightedMarker = null;\n        var timeSrv;\n\n        super($scope, $injector);\n        timeSrv = $injector.get('timeSrv');\n        this.panel.maxDataPoints = 10000;\n\n        var mapId = \"map-\" + String(guid());\n        var colorbarId = \"colorbar-\" + mapId;\n        var colorbar_;\n\n        this.panel.mapId  = mapId;\n\n        _.defaults(this.panel, panelDefaults);\n        var heatOpts = this.panel.heatOpts;\n        const dashboard = this.dashboard;\n\n        var metric = this.panel.metric;\n        var cmap = cmap_opts[this.panel.cmap];\n        var nbins = this.panel.nbins;\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('panel-initialized', this.render.bind(this));\n        this.events.on('data-received', function (data) {\n            coords = [];\n            var minLat = 90;\n            var maxLat = -90;\n            var minLon = 180;\n            var maxLon = -180;\n            var polylines = [];\n            var polyline = [];\n            var lastLineHasData = false;\n\n            if (data[0]!=undefined && data[0].rows!=undefined){\n                for (var i = 0; i < data[0].rows.length; i++) {\n                    const position = data[0].rows[i][1] ?\n                        Geohash.decode(data[0].rows[i][1]) :\n                        null;\n                    if (position) {\n                        minLat = Math.min(minLat, position.lat);\n                        minLon = Math.min(minLon, position.lng);\n                        maxLat = Math.max(maxLat, position.lat);\n                        maxLon = Math.max(maxLon, position.lng);\n                        polyline.push(position);\n                        lastLineHasData = true;\n                    } else {\n                        if (lastLineHasData) {\n                            polylines.push(polyline);\n                            polyline = [];\n                            lastLineHasData = false;\n                        }\n                    }\n                    coords.push({\n                        value: data[0].rows[i][2],\n                        hash: data[0].rows[i][1],\n                        position: position,\n                        timestamp: data[0].rows[i][0]\n                    });\n                }\n            }\n\n            if (lastLineHasData) {\n                polylines.push(polyline);\n            }\n\n            if (myMap) {\n                myMap.remove();\n            }\n\n            var center = coords.find(point => point.position);\n            center = center ? center.position : [0, 0];\n\n            myMap = L.map(mapId, {\n                zoomControl: false,\n                attributionControl:false\n            });\n\n            map_ctrl[mapId] = {\n                map: myMap,\n                count: coords.length,\n                chart_id: \"svg#hist-\"+mapId,\n            };\n\n            var values;\n            if (1) { // testing w fake values or not\n                values = coords.map(function(d) { return d.value;});\n            } else {\n                values = d3.range(1000).map(d3.randomBates(10));\n            }\n            var [min, max] = d3.extent(values);\n            var realValues = d3.scaleLinear().range([min, max]);\n            values = values.map(function(d) { return (d-min)/(max-min);});\n\n            var formatVal = d3.format(\",.00f\");\n\n            cleanPrevChart(mapId);\n\n            var hist = d3.select(map_ctrl[mapId]['chart_id']);\n                //hist.attr(\"preserveAspectRatio\", \"xMinYMin meet\")\n                //hist.attr(\"viewBox\", \"0 0 960 500\");\n\n            var wrap = $(\"div#wrap-hist-\"+mapId);\n\n            var margin = {top: 3, right: 3, bottom: 3, left: 3},\n                width = + wrap.width() - margin.left - margin.right,\n                height = + wrap.height() - margin.top - margin.bottom,\n                g = hist.append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n            var x = d3.scaleLinear().rangeRound([0, width]);\n\n            var histogram = d3.histogram()\n                .domain(x.domain())\n                .thresholds(x.ticks(nbins));\n\n            var bins = histogram(values);\n\n            var set_y_domain = function(d){\n                return d.length;\n            }\n\n            var y = d3.scaleLinear()\n                .domain([0, d3.max(bins, set_y_domain)])\n                .range([height, 0]);\n\n            var div = d3.select(\"body\").append(\"div\")\n                .attr(\"class\", \"tooltip\")\n                .style(\"opacity\", 0);\n\n            var bar = g.selectAll(\"bar\")\n                .data(bins)\n                .enter().append(\"g\")\n                .attr(\"class\", \"bar\")\n                .attr(\"transform\", function(d) { return \"translate(\" + x(d.x0) + \",\" + y(d.length) + \")\";  });\n\n            var set_mouseover = function(d) {\n                div.transition()\n                    .duration(50)\n                    .style(\"opacity\", .9)\n                    .style(\"background-color\", \"black\");\n                div.html(\"[\" + formatVal(realValues(d.x0)) +  \"-\" + formatVal(realValues(d.x1))+ \"]\")\n                    .style(\"left\", (d3.event.pageX) + \"px\")\n                    .style(\"top\", (d3.event.pageY - 28) + \"px\");\n            }\n\n            var set_mouseout = function(d) {\n                div.transition()\n                    .duration(50)\n                    .style(\"opacity\", 0);\n            }\n\n            var set_fill = function(d) {\n                var c = cmap(d.x0);\n                heatOpts.gradient[d.x1] = c;\n                return c;\n            };\n\n            var set_height = function(d) {\n                return height - y(d.length);\n            };\n\n            bar.append(\"rect\")\n                .attr(\"x\", 0)\n                .attr(\"width\", x(bins[0].x1) - x(bins[0].x0) - 1)\n                .attr(\"height\", set_height)\n                .attr(\"fill\", set_fill)\n                .on(\"mouseover\", set_mouseover)\n                .on(\"mouseout\", set_mouseout);\n\n            var fix = 0.000000000001;\n\n            if (data[0]!=undefined){\n                myMap.setView(new L.LatLng(40.730610, -73.935242), 18);\n            } else {\n                myMap.setView(new L.LatLng(center[0], center[1]), 18);\n            }\n\n            myMap.fitBounds([\n                [minLat + fix, minLon + fix],\n                [maxLat + fix, maxLon + fix]\n            ]);\n\n            var tiles = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {\n                attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n                subdomains: 'abcd',\n                maxZoom: 20\n            }).addTo(myMap);\n\n            function aggregateFun(cluster) {\n                var val = 0,\n                    childMarkers = cluster.getAllChildMarkers(), // Store in local variable to avoid having to execute it many times.\n                    total = childMarkers.length;\n                for (i = 0; i < total; i++) {\n                    val = val + parseInt(childMarkers[i].options.value)\n                }\n                var avg = val / total;\n                avg = Math.round(avg * 10) / 10;\n                var navg = (avg-min)/max;\n                return new L.divIcon({\n                    html: \"<div style='background-color: \" + cmap(navg) + \"'><span>\" + avg + \"</span></div>\",\n                    className: ' marker-cluster',\n                    iconSize: new L.point(40, 40)\n                })\n            }\n\n            var markers = L.markerClusterGroup( {\n                iconCreateFunction: aggregateFun,\n                spiderfyOnMaxZoom: false,\n                singleMarkerMode: true\n                    //disableClusteringAtZoom: 15\n                }\n            );\n\n            //data = coords.map(function (p) { return [p.position.lat, p.position.lng, p.value]; });\n\n            for (var i = 0; i < coords.length; i++) {\n                var a = coords[i];\n                var marker = L.marker(new L.LatLng(a.position.lat, a.position.lng, ), {\n                    title: a.value,\n                    value: a.value\n                });\n                marker.bindPopup(a.value);\n                markers.addLayer(marker);\n            }\n\n            myMap.addLayer(markers);\n\n            //var heatLayer = L.heatLayer(data, heatOpts).addTo(myMap);\n            //console.log(\"coords [\", metric,\"] \", coords.length);\n            syncMaps();\n\n        });\n    }\n\n    onInitEditMode() {\n        this.addEditorTab( 'Options', 'public/plugins/grafana-map-panel/editor.html', 2);\n    }\n\n    onPanelTeardown() {\n        this.$timeout.cancel(this.nextTickPromise);\n        //console.log(\"teardown: \", this);\n        map_ctrl[this.panel.mapId]['map'].remove();\n\n        var mapId = this.panel.mapId;\n        cleanPrevChart(mapId);\n\n        delete map_ctrl[this.panel.mapId];\n        syncMaps();\n    }\n\n    link(scope, elem) {\n        this.events.on('render', () => {\n            //const $panelContainer = elem.find('.panel-container');\n            //console.log(this.panel.heatOpts);\n            //console.log(\"link: \", Object.keys(scope.maps).length, scope.maps);\n            //if (scope.maps[this.panel.mapId] != undefined) {\n                //scope.maps[this.panel.mapId].setOptions(this.panel.heatOpts);\n                //scope.maps[this.panel.mapId].redraw();\n            //}\n        });\n    }\n}\n\nClockCtrl.templateUrl = 'module.html';\n\nvar Geohash = {};\n\n/* (Geohash-specific) Base32 map */\nGeohash.base32 = '0123456789bcdefghjkmnpqrstuvwxyz';\n\nGeohash.decode = function (geohash) {\n    var bounds = Geohash.bounds(geohash); // <-- the hard work\n    // now just determine the centre of the cell...\n\n    var latMin = bounds.sw.lat,\n        lonMin = bounds.sw.lng;\n    var latMax = bounds.ne.lat,\n        lonMax = bounds.ne.lng;\n\n    // cell centre\n    var lat = (latMin + latMax) / 2;\n    var lon = (lonMin + lonMax) / 2;\n\n    // round to close to centre without excessive precision: ⌊2-log10(Δ°)⌋ decimal places\n    lat = lat.toFixed(Math.floor(2 - Math.log(latMax - latMin) / Math.LN10));\n    lon = lon.toFixed(Math.floor(2 - Math.log(lonMax - lonMin) / Math.LN10));\n\n    return {\n        lat: Number(lat),\n        lng: Number(lon)\n    };\n};\n\nGeohash.bounds = function (geohash) {\n    if (geohash.length === 0) throw new Error('Invalid geohash');\n\n    geohash = geohash.toLowerCase();\n\n    var evenBit = true;\n    var latMin = -90,\n        latMax = 90;\n    var lonMin = -180,\n        lonMax = 180;\n\n    for (var i = 0; i < geohash.length; i++) {\n        var chr = geohash.charAt(i);\n        var idx = Geohash.base32.indexOf(chr);\n        if (idx == -1) throw new Error('Invalid geohash');\n        for (var n = 4; n >= 0; n--) {\n            var bitN = (idx >> n) & 1;\n            if (evenBit) {\n                // longitude\n                var lonMid = (lonMin + lonMax) / 2;\n                if (bitN == 1) {\n                    lonMin = lonMid;\n                } else {\n                    lonMax = lonMid;\n                }\n            } else {\n                // latitude\n                var latMid = (latMin + latMax) / 2;\n                if (bitN == 1) {\n                    latMin = latMid;\n                } else {\n                    latMax = latMid;\n                }\n            }\n            evenBit = !evenBit;\n        }\n    }\n\n    var bounds = {\n        sw: {\n            lat: latMin,\n            lng: lonMin\n        },\n        ne: {\n            lat: latMax,\n            lng: lonMax\n        }\n    };\n\n    return bounds;\n};\n"]}