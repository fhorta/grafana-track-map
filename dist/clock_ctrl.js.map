{"version":3,"sources":["../src/clock_ctrl.js"],"names":["hex","c","s","i","parseInt","isNaN","Math","round","min","max","charAt","convertToHex","rgb","trim","substring","convertToRGB","color","generateColor","colorStart","colorEnd","colorCount","start","end","len","alpha","ret","push","MetricsPanelCtrl","appEvents","coords","highlightedMarker","heatOpts","radius","minOpacity","maxZoom","blur","gradient","ClockCtrl","$scope","$injector","timeSrv","get","panel","maxDataPoints","dashboard","on","length","timestamp","event","pos","x","circle","setStyle","fillColor","events","onInitEditMode","bind","onPanelTeardown","render","data","minLat","maxLat","minLon","maxLon","polylines","polyline","lastLineHasData","undefined","rows","position","Geohash","decode","lat","lng","value","hash","myMap","remove","center","find","point","L","map","fix","fitBounds","tiles","tileLayer","attribution","subdomains","addTo","scale","opts","istart","domain","istop","ostart","range","ostop","nscale","mscale","mgradient","inc","mcolors","String","p","heatLayer","e","coordsInBox","filter","coord","boxZoomBounds","contains","latLng","minTime","apply","maxTime","console","log","Date","isFinite","setTime","from","moment","utc","to","addEditorTab","$timeout","cancel","nextTickPromise","scope","elem","$panelContainer","grad","c0","c1","c2","setOptions","redraw","templateUrl","base32","geohash","bounds","latMin","sw","lonMin","latMax","ne","lonMax","lon","toFixed","floor","LN10","Number","Error","toLowerCase","evenBit","chr","idx","indexOf","n","bitN","lonMid","latMid"],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["import './leaflet.js';\n//import _ from 'lodash';\n//import moment from 'moment';\nimport './css/clock-panel.css!';\nimport './leaflet.css!';\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport appEvents from 'app/core/app_events';\n\nvar myMap;\nvar coords = [];\nvar highlightedMarker = null;\nvar timeSrv;\n\nvar heatLayer;\nvar heatOpts = {\n    radius:20,\n    minOpacity: 0,\n    maxZoom: 18,\n    max: 600,\n    blur: 15,\n    gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}\n}\n\n//import './realworld-10000.js';\nimport './leaflet-heat.js';\n//import {h337} from './heatmap.js'\n//import {HeatmapOverlay} from './leaflet-heatmap.js';\n\nexport class ClockCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector) {\n\n        super($scope, $injector);\n        timeSrv = $injector.get('timeSrv');\n        this.panel.maxDataPoints = 500;\n        const dashboard = this.dashboard;\n        //\n        // don't forget to include leaflet-heatmap.js\n\n        appEvents.on('graph-hover', event => {\n            if (coords) {\n                for (var i = 0; i < coords.length; i++) {\n                    if (coords[i].timestamp >= event.pos.x) {\n                        if (coords[i].circle) {\n                            coords[i].circle.setStyle({\n                                fillColor: 'red',\n                                color: 'red'\n                            });\n                        }\n                        if (highlightedMarker) {\n                            highlightedMarker.setStyle({\n                                fillColor: 'none',\n                                color: 'none'\n                            });\n                        }\n                        highlightedMarker = coords[i].circle;\n                        break;\n                    }\n                }\n            }\n        });\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('panel-initialized', this.render.bind(this));\n        this.events.on('data-received', function (data) {\n            coords = [];\n            var minLat = 90;\n            var maxLat = -90;\n            var minLon = 180;\n            var maxLon = -180;\n            var polylines = [];\n            var polyline = [];\n            var lastLineHasData = false;\n\n            if (data[0]===undefined){\n                return false;\n            }\n\n            for (var i = 0; i < data[0].rows.length; i++) {\n                const position = data[0].rows[i][1] ?\n                    Geohash.decode(data[0].rows[i][1]) :\n                    null;\n                if (position) {\n                    minLat = Math.min(minLat, position.lat);\n                    minLon = Math.min(minLon, position.lng);\n                    maxLat = Math.max(maxLat, position.lat);\n                    maxLon = Math.max(maxLon, position.lng);\n                    polyline.push(position);\n                    lastLineHasData = true;\n                } else {\n                    if (lastLineHasData) {\n                        polylines.push(polyline);\n                        polyline = [];\n                        lastLineHasData = false;\n                    }\n                }\n                coords.push({\n                    value: data[0].rows[i][2],\n                    hash: data[0].rows[i][1],\n                    position: position,\n                    timestamp: data[0].rows[i][0]\n                });\n            }\n\n            if (lastLineHasData) {\n                polylines.push(polyline);\n            }\n\n            if (myMap) {\n                myMap.remove();\n            }\n\n            var center = coords.find(point => point.position);\n            center = center ? center.position : [0, 0];\n\n            myMap = L.map('themap');\n            var fix = 0.000000000001;\n            myMap.fitBounds([\n                [minLat + fix, minLon + fix],\n                [maxLat, maxLon]\n            ]);\n\n            //var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                //attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors',\n            //}).addTo(myMap);\n\n            var tiles = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {\n                attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n                subdomains: 'abcd',\n                maxZoom: 20\n            }).addTo(myMap);\n\n            var scale = function(opts){\n                var istart = opts.domain[0],\n                    istop  = opts.domain[1],\n                    ostart = opts.range[0],\n                    ostop  = opts.range[1];\n                return function scale(value) {\n                    return ostart + (ostop - ostart) * ((value - istart) / (istop - istart));\n                }\n            };\n\n            var nscale=10;\n            var mscale = scale({domain:[0,nscale],range:[0,1]});\n            var mgradient = {};\n            var inc = 0;\n            var mcolors = generateColor('#111111','#6495ED',nscale);\n\n            mcolors.map(function (c) {\n                mgradient[mscale(inc)] = \"#\"+String(mcolors[inc]);\n                inc+=1;\n            })\n\n            //console.log(\"Gradient: \", mgradient);\n\n            data = coords.map(function (p) { return [p.position.lat, p.position.lng, p.value]; });\n\n            heatLayer = L.heatLayer(data, heatOpts).addTo(myMap);\n\n            myMap.on('boxzoomend', function (e) {\n                const coordsInBox = coords.filter(\n                    coord =>\n                    coord.position &&\n                    e.boxZoomBounds.contains(\n                        L.latLng(coord.position.lat, coord.position.lng)\n                    )\n                );\n                const minTime = Math.min.apply(\n                    Math,\n                    coordsInBox.map(coord => coord.timestamp)\n                );\n                const maxTime = Math.max.apply(\n                    Math,\n                    coordsInBox.map(coord => coord.timestamp)\n                );\n                console.log(new Date(minTime));\n                console.log(new Date(maxTime));\n                if (isFinite(minTime) && isFinite(maxTime)) {\n                    timeSrv.setTime({\n                        from: moment.utc(minTime),\n                        to: moment.utc(maxTime)\n                    });\n                }\n            });\n        });\n\n    }\n\n    onInitEditMode() {\n        this.addEditorTab( 'Options', 'public/plugins/grafana-map-panel/editor.html', 2);\n    }\n\n    onPanelTeardown() {\n        this.$timeout.cancel(this.nextTickPromise);\n    }\n\n    link(scope, elem) {\n        this.events.on('render', () => {\n            const $panelContainer = elem.find('.panel-container');\n            heatOpts.gradient = {0.4: this.panel.grad.c0, 0.65: this.panel.grad.c1, 1: this.panel.grad.c2};\n            heatLayer.setOptions(heatOpts);\n            heatLayer.redraw();\n        });\n    }\n}\n\nClockCtrl.templateUrl = 'module.html';\n\nvar Geohash = {};\n\n/* (Geohash-specific) Base32 map */\nGeohash.base32 = '0123456789bcdefghjkmnpqrstuvwxyz';\n\nGeohash.decode = function (geohash) {\n    var bounds = Geohash.bounds(geohash); // <-- the hard work\n    // now just determine the centre of the cell...\n\n    var latMin = bounds.sw.lat,\n        lonMin = bounds.sw.lng;\n    var latMax = bounds.ne.lat,\n        lonMax = bounds.ne.lng;\n\n    // cell centre\n    var lat = (latMin + latMax) / 2;\n    var lon = (lonMin + lonMax) / 2;\n\n    // round to close to centre without excessive precision: ⌊2-log10(Δ°)⌋ decimal places\n    lat = lat.toFixed(Math.floor(2 - Math.log(latMax - latMin) / Math.LN10));\n    lon = lon.toFixed(Math.floor(2 - Math.log(lonMax - lonMin) / Math.LN10));\n\n    return {\n        lat: Number(lat),\n        lng: Number(lon)\n    };\n};\n\nGeohash.bounds = function (geohash) {\n    if (geohash.length === 0) throw new Error('Invalid geohash');\n\n    geohash = geohash.toLowerCase();\n\n    var evenBit = true;\n    var latMin = -90,\n        latMax = 90;\n    var lonMin = -180,\n        lonMax = 180;\n\n    for (var i = 0; i < geohash.length; i++) {\n        var chr = geohash.charAt(i);\n        var idx = Geohash.base32.indexOf(chr);\n        if (idx == -1) throw new Error('Invalid geohash');\n\n        for (var n = 4; n >= 0; n--) {\n            var bitN = (idx >> n) & 1;\n            if (evenBit) {\n                // longitude\n                var lonMid = (lonMin + lonMax) / 2;\n                if (bitN == 1) {\n                    lonMin = lonMid;\n                } else {\n                    lonMax = lonMid;\n                }\n            } else {\n                // latitude\n                var latMid = (latMin + latMax) / 2;\n                if (bitN == 1) {\n                    latMin = latMid;\n                } else {\n                    latMax = latMid;\n                }\n            }\n            evenBit = !evenBit;\n        }\n    }\n\n    var bounds = {\n        sw: {\n            lat: latMin,\n            lng: lonMin\n        },\n        ne: {\n            lat: latMax,\n            lng: lonMax\n        }\n    };\n\n    return bounds;\n};\n\nfunction hex (c) {\n  var s = \"0123456789abcdef\";\n  var i = parseInt (c);\n  if (i == 0 || isNaN (c))\n    return \"00\";\n  i = Math.round (Math.min (Math.max (0, i), 255));\n  return s.charAt ((i - i % 16) / 16) + s.charAt (i % 16);\n}\n\n/* Convert an RGB triplet to a hex string */\nfunction convertToHex (rgb) {\n  return hex(rgb[0]) + hex(rgb[1]) + hex(rgb[2]);\n}\n\n/* Remove '#' in color hex string */\nfunction trim (s) { return (s.charAt(0) == '#') ? s.substring(1, 7) : s }\n\n/* Convert a hex string to an RGB triplet */\nfunction convertToRGB (hex) {\n  var color = [];\n  color[0] = parseInt ((trim(hex)).substring (0, 2), 16);\n  color[1] = parseInt ((trim(hex)).substring (2, 4), 16);\n  color[2] = parseInt ((trim(hex)).substring (4, 6), 16);\n  return color;\n}\n\nfunction generateColor(colorStart,colorEnd,colorCount){\n    // The beginning of your gradient\n    var start = convertToRGB (colorStart);\n    // The end of your gradient\n    var end   = convertToRGB (colorEnd);\n    // The number of colors to compute\n    var len = colorCount;\n    //Alpha blending amount\n    var alpha = 0.0;\n    var ret = [];\n    for (var i = 0; i < len; i++) {\n        var c = [];\n        alpha += (1.0/len);\n        c[0] = start[0] * alpha + (1 - alpha) * end[0];\n        c[1] = start[1] * alpha + (1 - alpha) * end[1];\n        c[2] = start[2] * alpha + (1 - alpha) * end[2];\n        ret.push(convertToHex (c));\n    }\n    return ret;\n}\n"]}