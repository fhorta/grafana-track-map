{"version":3,"sources":["../src/clock_ctrl.js"],"names":["LL","_","moment","HeatmapJS","HeatmapOverlay","MetricsPanelCtrl","appEvents","coords","highlightedMarker","ClockCtrl","$scope","$injector","timeSrv","get","panel","maxDataPoints","dashboard","testData","max","baseLayer","L","tileLayer","maxZoom","cfg","radius","maxOpacity","scaleRadius","useLocalExtrema","latField","lngField","valueField","heatmapLayer","map","Map","center","LatLng","zoom","layers","setData","on","i","length","timestamp","event","pos","x","circle","setStyle","fillColor","color","events","onInitEditMode","bind","onPanelTeardown","render","data","minLat","maxLat","minLon","maxLon","polylines","polyline","lastLineHasData","datapoints","position","Geohash","decode","Math","min","lat","lng","push","value","hash","myMap","remove","find","point","fix","fitBounds","CartoDB_PositronNoLabels","attribution","subdomains","e","coordsInBox","filter","coord","boxZoomBounds","contains","latLng","minTime","apply","maxTime","console","log","Date","isFinite","setTime","from","utc","to","OpenTopoMap","addTo","OpenSeaMap","forEach","weight","opacity","circleMarker","stroke","fillOpacity","addEditorTab","$timeout","cancel","nextTickPromise","scope","elem","$panelContainer","bgColor","css","templateUrl","base32","geohash","bounds","latMin","sw","lonMin","latMax","ne","lonMax","lon","toFixed","floor","LN10","Number","Error","toLowerCase","evenBit","chr","charAt","idx","indexOf","n","bitN","lonMid","latMid"],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["import LL from './leaflet.js';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport HeatmapJS from './heatmap.js';\nimport HeatmapOverlay from './leaflet-heatmap.js';\nimport './css/clock-panel.css!';\nimport './leaflet.css!';\nimport {\n    MetricsPanelCtrl\n} from 'app/plugins/sdk';\nimport appEvents from 'app/core/app_events';\n\nvar myMap;\nvar coords = [];\nvar highlightedMarker = null;\nvar timeSrv;\n\nexport class ClockCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    timeSrv = $injector.get('timeSrv');\n    this.panel.maxDataPoints = 500;\n    const dashboard = this.dashboard;\n        //\n        // don't forget to include leaflet-heatmap.js\n    let testData = {\n      max: 8\n            // data: [{lat: 24.6408, lng:46.7728, count: 3},{lat: 50.75, lng:-1.55, count: 1}, ...]\n    };\n\n    var baseLayer = L.tileLayer(\n            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n                // attribution: '...',\n              maxZoom: 18\n            }\n        );\n\n    let cfg = {\n            // radius should be small ONLY if scaleRadius is true (or small radius is intended)\n            // if scaleRadius is false it will be the constant radius used in pixels\n      radius: 2,\n      maxOpacity: 0.8,\n            // scales the radius based on map zoom\n      scaleRadius: true,\n            // if set to false the heatmap uses the global maximum for colorization\n            // if activated: uses the data maximum within the current map boundaries\n            //   (there will always be a red spot with useLocalExtremas true)\n      useLocalExtrema: true,\n            // which field name in your data represents the latitude - default \"lat\"\n      latField: 'lat',\n            // which field name in your data represents the longitude - default \"lng\"\n      lngField: 'lng',\n            // which field name in your data represents the data value - default \"value\"\n      valueField: 'count'\n    };\n\n    const heatmapLayer = new HeatmapOverlay(cfg);\n\n    let map = new L.Map('map-canvas', {\n      center: new L.LatLng(25.6586, -80.3568),\n      zoom: 4,\n      layers: [baseLayer, heatmapLayer]\n    });\n\n    heatmapLayer.setData(testData);\n\n    appEvents.on('graph-hover', event => {\n      if (coords) {\n        for (var i = 0; i < coords.length; i++) {\n          if (coords[i].timestamp >= event.pos.x) {\n            if (coords[i].circle) {\n              coords[i].circle.setStyle({\n                fillColor: 'red',\n                color: 'red'\n              });\n            }\n            if (highlightedMarker) {\n              highlightedMarker.setStyle({\n                fillColor: 'none',\n                color: 'none'\n              });\n            }\n            highlightedMarker = coords[i].circle;\n            break;\n          }\n        }\n      }\n    });\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n    this.events.on('data-received', function (data) {\n      coords = [];\n      var minLat = 90;\n      var maxLat = -90;\n      var minLon = 180;\n      var maxLon = -180;\n      var polylines = [];\n      var polyline = [];\n      var lastLineHasData = false;\n      for (var i = 0; i < data[0].datapoints.length; i++) {\n        const position = data[1].datapoints[i][0] ?\n                    Geohash.decode(data[1].datapoints[i][0]) :\n                    null;\n        if (position) {\n          minLat = Math.min(minLat, position.lat);\n          minLon = Math.min(minLon, position.lng);\n          maxLat = Math.max(maxLat, position.lat);\n          maxLon = Math.max(maxLon, position.lng);\n          polyline.push(position);\n          lastLineHasData = true;\n        } else {\n          if (lastLineHasData) {\n            polylines.push(polyline);\n            polyline = [];\n            lastLineHasData = false;\n          }\n        }\n        coords.push({\n          value: data[0].datapoints[i][0],\n          hash: data[1].datapoints[i][0],\n          position: position,\n          timestamp: data[0].datapoints[i][1]\n        });\n      }\n\n      if (lastLineHasData) {\n        polylines.push(polyline);\n      }\n\n      if (myMap) {\n        myMap.remove();\n      }\n      var center = coords.find(point => point.position);\n      center = center ? center.position : [0, 0];\n      myMap = L.map('themap');\n      var fix = 0.000000000001;\n      myMap.fitBounds([\n                [minLat + fix, minLon + fix],\n                [maxLat, maxLon]\n      ]);\n      var CartoDB_PositronNoLabels = L.tileLayer(\n                'http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {\n                  attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n                  subdomains: 'abcd',\n                  maxZoom: 19\n                }\n            );\n\n            // var heatmapLayer = new HeatmapOverlay(cfg);\n\n      myMap.on('boxzoomend', function (e) {\n        const coordsInBox = coords.filter(\n                    coord =>\n                    coord.position &&\n                    e.boxZoomBounds.contains(\n                        L.latLng(coord.position.lat, coord.position.lng)\n                    )\n                );\n        const minTime = Math.min.apply(\n                    Math,\n                    coordsInBox.map(coord => coord.timestamp)\n                );\n        const maxTime = Math.max.apply(\n                    Math,\n                    coordsInBox.map(coord => coord.timestamp)\n                );\n        console.log(new Date(minTime));\n        console.log(new Date(maxTime));\n        if (isFinite(minTime) && isFinite(maxTime)) {\n          timeSrv.setTime({\n            from: moment.utc(minTime),\n            to: moment.utc(maxTime)\n          });\n        }\n      });\n\n      var OpenTopoMap = L.tileLayer(\n                'http://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {\n                  maxZoom: 17\n                }\n            );\n      OpenTopoMap.addTo(myMap);\n      var OpenSeaMap = L.tileLayer(\n                'http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png', {}\n            );\n\n      OpenSeaMap.addTo(myMap);\n      polylines.forEach(polyline => {\n        L.polyline(polyline, {\n          color: 'blue',\n          weight: 6,\n          opacity: 0.9\n        }).addTo(myMap);\n      });\n      coords.forEach(point => {\n        if (point.position) {\n          point.circle = L.circleMarker(point.position, {\n            color: 'none',\n            stroke: 'false',\n            fillColor: 'none',\n            fillOpacity: 0.5,\n            radius: 10\n          });\n          point.circle.addTo(myMap);\n        }\n      });\n    });\n  }\n\n  onInitEditMode() {\n    this.addEditorTab(\n            'Options',\n            'public/plugins/grafana-clock-panel/editor.html',\n            2\n        );\n  }\n\n  onPanelTeardown() {\n    this.$timeout.cancel(this.nextTickPromise);\n  }\n\n  link(scope, elem) {\n    this.events.on('render', () => {\n      const $panelContainer = elem.find('.panel-container');\n\n      if (this.panel.bgColor) {\n        $panelContainer.css('background-color', this.panel.bgColor);\n      } else {\n        $panelContainer.css('background-color', '');\n      }\n    });\n  }\n}\n\nClockCtrl.templateUrl = 'module.html';\n\nvar Geohash = {};\n\n/* (Geohash-specific) Base32 map */\nGeohash.base32 = '0123456789bcdefghjkmnpqrstuvwxyz';\n\nGeohash.decode = function (geohash) {\n  var bounds = Geohash.bounds(geohash); // <-- the hard work\n    // now just determine the centre of the cell...\n\n  var latMin = bounds.sw.lat,\n    lonMin = bounds.sw.lng;\n  var latMax = bounds.ne.lat,\n    lonMax = bounds.ne.lng;\n\n    // cell centre\n  var lat = (latMin + latMax) / 2;\n  var lon = (lonMin + lonMax) / 2;\n\n    // round to close to centre without excessive precision: ⌊2-log10(Δ°)⌋ decimal places\n  lat = lat.toFixed(Math.floor(2 - Math.log(latMax - latMin) / Math.LN10));\n  lon = lon.toFixed(Math.floor(2 - Math.log(lonMax - lonMin) / Math.LN10));\n\n  return {\n    lat: Number(lat),\n    lng: Number(lon)\n  };\n};\n\nGeohash.bounds = function (geohash) {\n  if (geohash.length === 0) throw new Error('Invalid geohash');\n\n  geohash = geohash.toLowerCase();\n\n  var evenBit = true;\n  var latMin = -90,\n    latMax = 90;\n  var lonMin = -180,\n    lonMax = 180;\n\n  for (var i = 0; i < geohash.length; i++) {\n    var chr = geohash.charAt(i);\n    var idx = Geohash.base32.indexOf(chr);\n    if (idx == -1) throw new Error('Invalid geohash');\n\n    for (var n = 4; n >= 0; n--) {\n      var bitN = (idx >> n) & 1;\n      if (evenBit) {\n                // longitude\n        var lonMid = (lonMin + lonMax) / 2;\n        if (bitN == 1) {\n          lonMin = lonMid;\n        } else {\n          lonMax = lonMid;\n        }\n      } else {\n                // latitude\n        var latMid = (latMin + latMax) / 2;\n        if (bitN == 1) {\n          latMin = latMid;\n        } else {\n          latMax = latMid;\n        }\n      }\n      evenBit = !evenBit;\n    }\n  }\n\n  var bounds = {\n    sw: {\n      lat: latMin,\n      lng: lonMin\n    },\n    ne: {\n      lat: latMax,\n      lng: lonMax\n    }\n  };\n\n  return bounds;\n};\n"]}