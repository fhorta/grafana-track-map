{"version":3,"sources":["../src/clock_ctrl.js"],"names":["guid","s4","Math","floor","random","toString","substring","cleanPrevChart","mapId","cid","map_ctrl","d3","select","remove","loadGradient","gradient","ret","values","c0","v","c1","c2","c","syncMaps","map_list","k","hasOwnProperty","push","length","combos","i","j","m","A","B","sync","hex","s","parseInt","isNaN","round","min","max","charAt","convertToHex","rgb","trim","convertToRGB","color","generateColor","colorStart","colorEnd","colorCount","start","end","len","alpha","Colorbar","scale","margin","top","right","bottom","left","orient","origin","x","y","barlength","thickness","title","scaleType","checkScaleType","cop","copy","range","domain","invertExtent","abs","log","sqrt","chart","selection","fillLegend","fillLegendScale","pointTo","inputNumbers","pointer","selectAll","pointerWidth","pointers","data","pointerSVGdef","enter","append","attr","classed","transition","duration","delay","each","thickness_attr","length_attr","axis_orient","position_variable","non_position_variable","axis_transform","tmp","svg","new_colorbars","d","offsetGroup","style","invert","linear","extent","legendRange","by","reverse","colorScaleRects","exit","colorAxisFunction","axis","quantiles","quantileScaleMarkers","concat","console","tickValues","call","titles","label","text","prettyName","number","comparisontype","suffix","value","arguments","warn","_","MetricsPanelCtrl","appEvents","cmap_opts","interpolateInferno","interpolatePlasma","interpolateRainbow","heatOpts","radius","minOpacity","maxZoom","blur","panelDefaults","ClockCtrl","$scope","$injector","myMap","coords","highlightedMarker","timeSrv","get","panel","maxDataPoints","String","colorbarId","colorbar_","defaults","dashboard","metric","cmap","nbins","events","on","onInitEditMode","bind","onPanelTeardown","render","minLat","maxLat","minLon","maxLon","polylines","polyline","lastLineHasData","undefined","rows","position","Geohash","decode","lat","lng","hash","timestamp","center","find","point","L","map","zoomControl","attributionControl","count","chart_id","randomBates","realValues","scaleLinear","formatVal","format","hist","wrap","$","width","height","g","rangeRound","histogram","thresholds","ticks","bins","div","bar","x0","set_mouseover","html","x1","event","pageX","pageY","set_mouseout","set_fill","fix","setView","LatLng","fitBounds","tiles","tileLayer","attribution","subdomains","addTo","p","heatLayer","addEditorTab","$timeout","cancel","nextTickPromise","scope","elem","templateUrl","base32","geohash","bounds","latMin","sw","lonMin","latMax","ne","lonMax","lon","toFixed","LN10","Number","Error","toLowerCase","evenBit","chr","idx","indexOf","n","bitN","lonMid","latMid"],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["import './leaflet.js';\nimport _ from 'lodash';\n//import moment from 'moment';\nimport './css/clock-panel.css!';\nimport './leaflet.css!';\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport appEvents from 'app/core/app_events';\n\nimport './leaflet-heat.js';\nimport './leaflet-sync.js';\n\nimport * as d3 from './external/d3.min.js';\nimport './external/d3-color.min.js';\n\nvar map_ctrl = {};\n\nvar cmap_opts = {\n    \"inferno\": d3.interpolateInferno,\n    \"plasma\": d3.interpolatePlasma,\n    \"rainbow\": d3.interpolateRainbow,\n}\n\nfunction guid() {\n    function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1);\n    }\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n}\n\nfunction cleanPrevChart(mapId){\n    var cid = map_ctrl[mapId]['chart_id'] + \" > *\";\n    d3.select(cid).remove();\n}\n\nfunction loadGradient(gradient){\n    var ret = {};\n    var values = [\n        gradient.c0.v,\n        gradient.c1.v,\n        gradient.c2.v,\n    ]\n    ret[values[0]] = gradient.c0.c;\n    ret[values[1]] = gradient.c1.c;\n    ret[values[2]] = gradient.c2.c;\n    return ret;\n}\n\nvar heatOpts = {\n    radius:20,\n    minOpacity: 0,\n    maxZoom: 18,\n    max: 600,\n    blur: 15,\n    gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}\n}\n\nconst panelDefaults = {\n    'metric': \"undefined\",\n    'heatOpts': heatOpts,\n    'cmap': \"rainbow\",\n    'nbins': 10\n};\n\n//import './realworld-10000.js';\n//import {h337} from './heatmap.js'\n//import {HeatmapOverlay} from './leaflet-heatmap.js';\n//\n\nfunction syncMaps(){\n    //console.log(map_ctrl);\n    var map_list = [];\n    for (var k in map_ctrl) {\n        if (map_ctrl.hasOwnProperty(k)) {\n            if (map_ctrl[k]['count']>0) {\n                map_list.push(map_ctrl[k]['map']);\n            }\n        }\n    }\n    //console.log(map_list);\n\n    if (map_list.length>1) {\n        var combos = [];\n        for (var i = 0; i < map_list.length; i++)\n            for (var j = i + 1; j < map_list.length; j++)\n                combos.push([map_list[i], map_list[j]]);\n\n        //console.log(\"Combos: \", combos.length);\n        for (var m in combos){\n            var A = combos[m][0];\n            var B = combos[m][1];\n            A.sync(B);\n            B.sync(A);\n        }\n    }\n\n}\n\n\nexport class ClockCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector) {\n\n        var myMap;\n        var coords = [];\n        var highlightedMarker = null;\n        var timeSrv;\n\n        super($scope, $injector);\n        timeSrv = $injector.get('timeSrv');\n        this.panel.maxDataPoints = 10000;\n\n        var mapId = \"map-\" + String(guid());\n        var colorbarId = \"colorbar-\" + mapId;\n        var colorbar_;\n\n        this.panel.mapId  = mapId;\n\n        _.defaults(this.panel, panelDefaults);\n        var heatOpts = this.panel.heatOpts;\n        const dashboard = this.dashboard;\n\n        var metric = this.panel.metric;\n        var cmap = cmap_opts[this.panel.cmap];\n        var nbins = this.panel.nbins;\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('panel-initialized', this.render.bind(this));\n        this.events.on('data-received', function (data) {\n            coords = [];\n            var minLat = 90;\n            var maxLat = -90;\n            var minLon = 180;\n            var maxLon = -180;\n            var polylines = [];\n            var polyline = [];\n            var lastLineHasData = false;\n\n            if (data[0]!=undefined && data[0].rows!=undefined){\n                for (var i = 0; i < data[0].rows.length; i++) {\n                    const position = data[0].rows[i][1] ?\n                        Geohash.decode(data[0].rows[i][1]) :\n                        null;\n                    if (position) {\n                        minLat = Math.min(minLat, position.lat);\n                        minLon = Math.min(minLon, position.lng);\n                        maxLat = Math.max(maxLat, position.lat);\n                        maxLon = Math.max(maxLon, position.lng);\n                        polyline.push(position);\n                        lastLineHasData = true;\n                    } else {\n                        if (lastLineHasData) {\n                            polylines.push(polyline);\n                            polyline = [];\n                            lastLineHasData = false;\n                        }\n                    }\n                    coords.push({\n                        value: data[0].rows[i][2],\n                        hash: data[0].rows[i][1],\n                        position: position,\n                        timestamp: data[0].rows[i][0]\n                    });\n                }\n            }\n\n            if (lastLineHasData) {\n                polylines.push(polyline);\n            }\n\n            if (myMap) {\n                myMap.remove();\n            }\n\n            var center = coords.find(point => point.position);\n            center = center ? center.position : [0, 0];\n\n            myMap = L.map(mapId, {\n                zoomControl: false,\n                attributionControl:false\n            });\n\n            map_ctrl[mapId] = {\n                map: myMap,\n                count: coords.length,\n                chart_id: \"svg#hist-\"+mapId,\n            };\n\n            var values;\n            if (1) { // testing w fake values or not\n                values = coords.map(function(d) { return d.value;});\n            } else {\n                values = d3.range(1000).map(d3.randomBates(10));\n            }\n            var [min, max] = d3.extent(values);\n            var realValues = d3.scaleLinear().range([min, max]);\n            values = values.map(function(d) { return (d-min)/max;});\n\n            var formatVal = d3.format(\",.00f\");\n\n            cleanPrevChart(mapId);\n\n            var hist = d3.select(map_ctrl[mapId]['chart_id']);\n                //hist.attr(\"preserveAspectRatio\", \"xMinYMin meet\")\n                //hist.attr(\"viewBox\", \"0 0 960 500\");\n\n            var wrap = $(\"div#wrap-hist-\"+mapId);\n\n            var margin = {top: 0, right: 0, bottom: 0, left: 0},\n                width = + wrap.width() - margin.left - margin.right,\n                height = + wrap.height() - margin.top - margin.bottom,\n                g = hist.append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n            var x = d3.scaleLinear().rangeRound([0, width]);\n\n            var histogram = d3.histogram()\n                .domain(x.domain())\n                .thresholds(x.ticks(nbins));\n\n            var bins = histogram(values);\n            // Scale the range of the data in the y domain\n\n            var y = d3.scaleLinear()\n                .domain([0, d3.max(bins, function(d) { return d.length;  })])\n                .range([height, 0]);\n\n            var div = d3.select(\"body\").append(\"div\")\n                .attr(\"class\", \"tooltip\")\n                .style(\"opacity\", 0);\n\n            var bar = g.selectAll(\"bar\")\n                .data(bins)\n                .enter().append(\"g\")\n                .attr(\"class\", \"bar\")\n                .attr(\"transform\", function(d) { return \"translate(\" + x(d.x0) + \",\" + y(d.length) + \")\";  });\n\n            var set_mouseover = function(d) {\n                div.transition()\n                    .duration(50)\n                    .style(\"opacity\", .9)\n                    .style(\"background-color\", \"black\");\n                div.html(\"[\" + formatVal(realValues(d.x0)) +  \"-\" + formatVal(realValues(d.x1))+ \"]\")\n                    .style(\"left\", (d3.event.pageX) + \"px\")\n                    .style(\"top\", (d3.event.pageY - 28) + \"px\");\n            }\n\n            var set_mouseout = function(d) {\n                div.transition()\n                    .duration(50)\n                    .style(\"opacity\", 0);\n            }\n\n            var set_fill = function(d) {\n                var c = cmap(d.x0);\n                heatOpts.gradient[d.x1] = c;\n                return c;\n            };\n\n            bar.append(\"rect\")\n                .attr(\"x\", 0)\n                .attr(\"width\", x(bins[0].x1) - x(bins[0].x0) - 1)\n                .attr(\"height\", function(d) { return height - y(d.length);  })\n                .attr(\"fill\", set_fill)\n                .on(\"mouseover\", set_mouseover)\n                .on(\"mouseout\", set_mouseout);\n\n            var fix = 0.000000000001;\n\n            if (data[0]!=undefined){\n                myMap.setView(new L.LatLng(40.730610, -73.935242), 18);\n            } else {\n                myMap.setView(new L.LatLng(center[0], center[1]), 18);\n            }\n\n            myMap.fitBounds([\n                [minLat + fix, minLon + fix],\n                [maxLat + fix, maxLon + fix]\n            ]);\n\n            var tiles = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {\n                attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n                subdomains: 'abcd',\n                maxZoom: 20\n            }).addTo(myMap);\n\n            data = coords.map(function (p) { return [p.position.lat, p.position.lng, p.value]; });\n            var heatLayer = L.heatLayer(data, heatOpts).addTo(myMap);\n            //console.log(\"coords [\", metric,\"] \", coords.length);\n            syncMaps();\n\n        });\n    }\n\n    onInitEditMode() {\n        this.addEditorTab( 'Options', 'public/plugins/grafana-map-panel/editor.html', 2);\n    }\n\n    onPanelTeardown() {\n        this.$timeout.cancel(this.nextTickPromise);\n        //console.log(\"teardown: \", this);\n        map_ctrl[this.panel.mapId]['map'].remove();\n\n        var mapId = this.panel.mapId;\n        cleanPrevChart(mapId);\n\n        delete map_ctrl[this.panel.mapId];\n        syncMaps();\n    }\n\n    link(scope, elem) {\n        this.events.on('render', () => {\n            //const $panelContainer = elem.find('.panel-container');\n            //console.log(this.panel.heatOpts);\n            //console.log(\"link: \", Object.keys(scope.maps).length, scope.maps);\n            //if (scope.maps[this.panel.mapId] != undefined) {\n                //scope.maps[this.panel.mapId].setOptions(this.panel.heatOpts);\n                //scope.maps[this.panel.mapId].redraw();\n            //}\n        });\n    }\n}\n\nClockCtrl.templateUrl = 'module.html';\n\nvar Geohash = {};\n\n/* (Geohash-specific) Base32 map */\nGeohash.base32 = '0123456789bcdefghjkmnpqrstuvwxyz';\n\nGeohash.decode = function (geohash) {\n    var bounds = Geohash.bounds(geohash); // <-- the hard work\n    // now just determine the centre of the cell...\n\n    var latMin = bounds.sw.lat,\n        lonMin = bounds.sw.lng;\n    var latMax = bounds.ne.lat,\n        lonMax = bounds.ne.lng;\n\n    // cell centre\n    var lat = (latMin + latMax) / 2;\n    var lon = (lonMin + lonMax) / 2;\n\n    // round to close to centre without excessive precision: ⌊2-log10(Δ°)⌋ decimal places\n    lat = lat.toFixed(Math.floor(2 - Math.log(latMax - latMin) / Math.LN10));\n    lon = lon.toFixed(Math.floor(2 - Math.log(lonMax - lonMin) / Math.LN10));\n\n    return {\n        lat: Number(lat),\n        lng: Number(lon)\n    };\n};\n\nGeohash.bounds = function (geohash) {\n    if (geohash.length === 0) throw new Error('Invalid geohash');\n\n    geohash = geohash.toLowerCase();\n\n    var evenBit = true;\n    var latMin = -90,\n        latMax = 90;\n    var lonMin = -180,\n        lonMax = 180;\n\n    for (var i = 0; i < geohash.length; i++) {\n        var chr = geohash.charAt(i);\n        var idx = Geohash.base32.indexOf(chr);\n        if (idx == -1) throw new Error('Invalid geohash');\n        for (var n = 4; n >= 0; n--) {\n            var bitN = (idx >> n) & 1;\n            if (evenBit) {\n                // longitude\n                var lonMid = (lonMin + lonMax) / 2;\n                if (bitN == 1) {\n                    lonMin = lonMid;\n                } else {\n                    lonMax = lonMid;\n                }\n            } else {\n                // latitude\n                var latMid = (latMin + latMax) / 2;\n                if (bitN == 1) {\n                    latMin = latMid;\n                } else {\n                    latMax = latMid;\n                }\n            }\n            evenBit = !evenBit;\n        }\n    }\n\n    var bounds = {\n        sw: {\n            lat: latMin,\n            lng: lonMin\n        },\n        ne: {\n            lat: latMax,\n            lng: lonMax\n        }\n    };\n\n    return bounds;\n};\n\nfunction hex (c) {\n  var s = \"0123456789abcdef\";\n  var i = parseInt (c);\n  if (i == 0 || isNaN (c))\n    return \"00\";\n  i = Math.round (Math.min (Math.max (0, i), 255));\n  return s.charAt ((i - i % 16) / 16) + s.charAt (i % 16);\n}\n\n/* Convert an RGB triplet to a hex string */\nfunction convertToHex (rgb) {\n  return hex(rgb[0]) + hex(rgb[1]) + hex(rgb[2]);\n}\n\n/* Remove '#' in color hex string */\nfunction trim (s) { return (s.charAt(0) == '#') ? s.substring(1, 7) : s }\n\n/* Convert a hex string to an RGB triplet */\nfunction convertToRGB (hex) {\n  var color = [];\n  color[0] = parseInt ((trim(hex)).substring (0, 2), 16);\n  color[1] = parseInt ((trim(hex)).substring (2, 4), 16);\n  color[2] = parseInt ((trim(hex)).substring (4, 6), 16);\n  return color;\n}\n\nfunction generateColor(colorStart,colorEnd,colorCount){\n    // The beginning of your gradient\n    var start = convertToRGB (colorStart);\n    // The end of your gradient\n    var end   = convertToRGB (colorEnd);\n    // The number of colors to compute\n    var len = colorCount;\n    //Alpha blending amount\n    var alpha = 0.0;\n    var ret = [];\n    for (var i = 0; i < len; i++) {\n        var c = [];\n        alpha += (1.0/len);\n        c[0] = start[0] * alpha + (1 - alpha) * end[0];\n        c[1] = start[1] * alpha + (1 - alpha) * end[1];\n        c[2] = start[2] * alpha + (1 - alpha) * end[2];\n        ret.push(convertToHex (c));\n    }\n    return ret;\n}\n\n//thanks to: https://github.com/bmschmidt/colorbar\nfunction Colorbar() {\n\n    var scale, // the input scale this represents;\n        margin = {top: 5, right: 30, bottom: 25, left: 0}\n\n    var orient = \"vertical\",\n        origin = {\n            x: 0,\n            y: 0\n        }, // where on the parent to put it\n        barlength = 100, // how long is the bar\n        thickness = 50, // how thick is the bar\n        title = \"\", // title for the colorbar\n        scaleType = \"linear\";\n\n    var checkScaleType = function (scale) {\n        // AFAIK, d3 scale types aren't easily accessible from the scale itself.\n        // But we need to know the scale type for formatting axes properly\n        //Or do we? this variable seems not to be used.\n        cop = scale.copy();\n        cop.range([0, 1]);\n        cop.domain([1, 10]);\n\n        if (typeof(cop.invertExtent)!=\"undefined\") {\n            return \"quantile\"\n        }\n        if (Math.abs((cop(10) - cop(1)) / Math.log(10) - (cop(10) - cop(2)) / Math.log(5)) < 1e-6) {\n            return \"log\"\n        }\n        else if (Math.abs((cop(10) - cop(1)) / 9 - (cop(10) - cop(2)) / 8) < 1e-6) {\n            return \"linear\"\n        }\n        else if (Math.abs((cop(10) - cop(1)) / (Math.sqrt(10) - 1) - (cop(10) - cop(2)) / (Math.sqrt(10) - Math.sqrt(2))) < 1e-6) {\n            return \"sqrt\"\n        }\n        else {\n            return \"unknown\"\n        }\n    }\n\n    function chart(selection) {\n        var fillLegend,\n            fillLegendScale;\n\n        selection.pointTo = function(inputNumbers) {\n            var pointer = fillLegend.selectAll(\".pointer\");\n            var pointerWidth = Math.round(thickness*3/4);\n\n\n            //Also creates a pointer if it doesn't exist yet.\n            pointers = fillLegend\n                .selectAll('.pointer')\n                .data([inputNumbers]);\n\n            pointerSVGdef = function() {\n                return (\n                    orient==\"horizontal\" ?\n                    'M ' + 0 +' '+ thickness + ' l -' +  pointerWidth + ' -' + pointerWidth + ' l ' + 2*pointerWidth + ' -' + 0 + ' z' :\n                    'M ' + thickness +' '+ 0 + ' l -' +  pointerWidth + ' -' + pointerWidth + ' l ' + 0 + ' ' +  2*pointerWidth + ' z'\n\n                )\n            }\n\n            pointers\n                .enter()\n                .append('path')\n                .attr('transform',\"translate(0,\" + (\n                    fillLegendScale(inputNumbers) - pointerWidth)+ ')'\n                )\n                .classed(\"pointer\",true)\n                .classed(\"axis\",true)\n                .attr('d', pointerSVGdef())\n                .attr(\"fill\",\"grey\")\n                .attr(\"opacity\",\"0\");\n\n            //whether it's new or not, it updates it.\n            pointers\n                .transition()\n                .duration(1000)\n                .attr('opacity',1)\n                .attr('transform',\n                    orient==\"vertical\" ?\n                    \"translate(0,\" + (fillLegendScale(inputNumbers))+ ')':\n                    \"translate(\" + (fillLegendScale(inputNumbers))+ ',0)'\n                )\n            //and then it fades the pointer out over 5 seconds.\n                .transition()\n                .delay(2000)\n                .duration(3000)\n                .attr('opacity',0)\n                .remove();\n        }\n\n        selection.each(function(data) {\n\n            var scaleType = checkScaleType(scale);\n            var thickness_attr;\n            var length_attr;\n            var axis_orient;\n            var position_variable,non_position_variable;\n            var axis_transform;\n\n            if (orient === \"horizontal\") {\n                var tmp = [margin.left, margin.right, margin.top, margin.bottom]\n                margin.top = tmp[0]\n                margin.bottom = tmp[1]\n                margin.left = tmp[2]\n                margin.right = tmp[3]\n                thickness_attr = \"height\"\n                length_attr = \"width\"\n                axis_orient = \"bottom\"\n                position_variable = \"x\"\n                non_position_variable = \"y\"\n                axis_transform = \"translate (0,\" + thickness + \")\"\n            }\n\n            else {\n                thickness_attr = \"width\"\n                length_attr = \"height\"\n                axis_orient = \"right\"\n                position_variable = \"y\"\n                non_position_variable = \"x\"\n                axis_transform = \"translate (\" + thickness + \",\" + 0 + \")\"\n            }\n\n            // select the svg if it exists\n            var svg = d3.select(this)\n                .selectAll(\"svg.colorbar\")\n                .data([origin]);\n\n            // otherwise create the skeletal chart\n            var new_colorbars = svg.enter()\n                .append(\"svg\")\n                .classed(\"colorbar\", true)\n                .attr(\"x\",function(d) {return d[0]-margin.right})\n                .attr(\"y\",function(d) {return d[1]-margin.top})\n\n            offsetGroup = new_colorbars\n                .append(\"g\")\n                .classed(\"colorbar\", true)\n                .attr(\"transform\",\"translate(\" + margin.left + \",\" + margin.top + \")\")\n\n            offsetGroup.append(\"g\")\n                .attr(\"class\",\"legend rectArea\")\n\n            offsetGroup.append(\"g\")\n                .attr(\"class\",\"axis color\")\n\n            svg\n                .attr(thickness_attr, thickness + margin.left + margin.right)\n                .attr(length_attr, barlength + margin.top + margin.bottom)\n                .style(\"margin-top\", origin.y - margin.top + \"px\")\n                .style(\"margin-left\", origin.x - margin.left + \"px\")\n\n\n            // This either creates, or updates, a fill legend, and drops it\n            // on the screen. A fill legend includes a pointer chart can be\n            // updated in response to mouseovers, because that's way cool.\n\n            fillLegend = svg.selectAll(\"g.colorbar\")\n                .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n            fillLegendScale = scale.copy();\n\n            if (typeof(fillLegendScale.invert)==\"undefined\") {\n                //console.log(\"assuming it's a quantile scale\")\n                fillLegendScale = d3.scale\n                    .linear()\n                    .domain(d3.extent(fillLegendScale.domain()))\n            }\n\n            var legendRange = d3.range(\n                0, barlength,\n                by=barlength / (fillLegendScale.domain().length - 1));\n\n            legendRange.push(barlength);\n\n            if (orient==\"vertical\") {\n                //Vertical should go bottom to top, horizontal from left to right.\n                //This should be changeable in the options, ideally.\n                legendRange.reverse()\n            }\n            fillLegendScale.range(legendRange);\n\n            colorScaleRects = fillLegend\n                .selectAll(\"rect.legend\")\n                .data(d3.range(0, barlength));\n\n            colorScaleRects\n                .enter()\n                .append(\"rect\")\n                .attr(\"class\", \"legend\")\n                .style(\"opacity\", 0)\n                .style(\"stroke-thickness\", 0)\n                .style(\"fill\", function(d) {\n                    return scale(fillLegendScale.invert(d));\n                })\n\n            colorScaleRects\n                .exit()\n                .remove();\n\n            //Switch to using the original selection so that the transition will be inheirited\n            selection\n                .selectAll(\"rect.legend\")\n                .style(\"opacity\", 1)\n                .attr(thickness_attr, thickness)\n                .attr(length_attr, 2) // single pixel thickness produces ghosting on some browsers\n                .attr(position_variable, function(d) {return d;})\n                .attr(non_position_variable, 0)\n                .style(\"fill\", function(d) {\n                    return scale(fillLegendScale.invert(d));\n                })\n\n\n            colorAxisFunction = d3.svg.axis()\n                .scale(fillLegendScale)\n                .orient(axis_orient);\n\n            if (typeof(scale.quantiles) != \"undefined\") {\n                quantileScaleMarkers = scale.quantiles().concat( d3.extent(scale.domain()))\n                console.log(quantileScaleMarkers)\n                colorAxisFunction.tickValues(quantileScaleMarkers)\n            }\n\n            //Now make an axis\n            fillLegend.selectAll(\".color.axis\")\n                .attr(\"transform\", axis_transform)\n                .call(colorAxisFunction);\n\n            //make a title\n            titles = fillLegend.selectAll(\".axis.title\")\n                .data([{label: title}])\n                .attr(\"id\", \"#colorSelector\")\n                .attr('transform', 'translate (0, -10)')\n                .style(\"text-anchor\", \"middle\")\n                .text(function(d) {return d.label});\n\n            titles\n                .exit()\n                .remove();\n\n            //            return this;\n        });\n    }\n\n    function prettyName(number) {\n\n        var comparisontype = comparisontype || function() {return \"\"}\n\n        if (comparisontype()!='comparison') {\n            suffix = ''\n            switch(true) {\n                case number>=1000000000:\n                    number = number/1000000000\n                    suffix = 'B'\n                    break;\n                case number>=1000000:\n                    number = number/1000000\n                    suffix = 'M'\n                    break;\n                case number>=1000:\n                    number = number/1000\n                    suffix = 'K'\n                    break;\n            }\n            if (number < .1) {\n                return(Math.round(number*100)/100+suffix)\n            }\n            return(Math.round(number*10)/10+suffix)\n        }\n        if (comparisontype()=='comparison') {\n            if (number >= 1) {return(Math.round(number)) + \":1\"}\n            if (number < 1) {return(\"1:\" + Math.round(1/number))}\n        }\n    }\n\n    //getter-setters\n    chart.origin = function(value) {\n        if (!arguments.length) return origin;\n        origin = value;\n        return chart;\n    }\n\n    chart.margin = function(value) {\n        if (!arguments.length) return margin;\n        margin = value;\n        return chart;\n    }\n\n    chart.thickness = function(value) {\n        if (!arguments.length) return thickness;\n        thickness = value;\n        return chart;\n    }\n\n    chart.barlength = function(value) {\n        if (!arguments.length) return barlength;\n        barlength = value;\n        return chart;\n    }\n\n    chart.title = function(value) {\n        if (!arguments.length) return title;\n        title = value;\n        return chart;\n    }\n\n    chart.scale = function(value) {\n        if (!arguments.length) return scale;\n        scale = value;\n        return chart;\n    }\n\n    chart.orient = function(value) {\n        if (!arguments.length) return orient;\n        if (value === \"vertical\" || value === \"horizontal\")\n            orient = value;\n        else\n            console.warn(\"orient can be only vertical or horizontal, not\", value);\n        orient = value;\n        return chart;\n    }\n\n    return chart;\n}\n\n"]}