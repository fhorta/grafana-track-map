{"version":3,"sources":["../src/leaflet-heatmap.js"],"names":["name","context","factory","module","exports","require","define","amd","window","h337","Error","L","Layer","Class","HeatmapOverlay","extend","initialize","config","cfg","_el","DomUtil","create","_data","_max","_min","container","onAdd","map","size","getSize","_map","_width","x","_height","y","style","width","height","position","_origin","layerPointToLatLng","Point","getPanes","overlayPane","appendChild","_heatmap","on","_reset","_draw","addTo","addLayer","onRemove","removeChild","off","mapPane","point","_leaflet_pos","CSS_TRANSFORM","Math","round","_update","bounds","zoom","scale","generatedData","max","min","data","getBounds","getZoom","pow","length","setData","latLngPoints","radiusMultiplier","scaleRadius","localMax","localMin","valueField","len","entry","value","latlng","contains","latLngToContainerPoint","latlngPoint","radius","push","useLocalExtrema","latField","lngField","d","LatLng","dataObj","addData","pointOrArray","_renderer","setDimensions","div","document","createElement","props","i","prop","undefined"],"mappings":"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","file":"leaflet-heatmap.js","sourcesContent":["/*\n* Leaflet Heatmap Overlay\n*\n* Copyright (c) 2008-2016, Patrick Wied (https://www.patrick-wied.at)\n* Dual-licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)\n* and the Beerware (http://en.wikipedia.org/wiki/Beerware) license.\n*/\n;(function (name, context, factory) {\n  // Supports UMD. AMD, CommonJS/Node.js and browser context\n  if (typeof module !== \"undefined\" && module.exports) {\n    module.exports = factory(\n      require('heatmap.js'),\n      require('leaflet')\n    );\n  } else if (typeof define === \"function\" && define.amd) {\n    define(['heatmap.js', 'leaflet'], factory);\n  } else {\n    // browser globals\n    if (typeof window.h337 === 'undefined') {\n      throw new Error('heatmap.js must be loaded before the leaflet heatmap plugin');\n    }\n    if (typeof window.L === 'undefined') {\n      throw new Error('Leaflet must be loaded before the leaflet heatmap plugin');\n    }\n    context[name] = factory(window.h337, window.L);\n  }\n\n})(\"HeatmapOverlay\", this, function (h337, L) {\n  'use strict';\n\n  // Leaflet < 0.8 compatibility\n  if (typeof L.Layer === 'undefined') {\n    L.Layer = L.Class;\n  }\n\n  var HeatmapOverlay = L.Layer.extend({\n\n    initialize: function (config) {\n      this.cfg = config;\n      this._el = L.DomUtil.create('div', 'leaflet-zoom-hide');\n      this._data = [];\n      this._max = 1;\n      this._min = 0;\n      this.cfg.container = this._el;\n    },\n\n    onAdd: function (map) {\n      var size = map.getSize();\n\n      this._map = map;\n\n      this._width = size.x;\n      this._height = size.y;\n\n      this._el.style.width = size.x + 'px';\n      this._el.style.height = size.y + 'px';\n      this._el.style.position = 'absolute';\n\n      this._origin = this._map.layerPointToLatLng(new L.Point(0, 0));\n\n      map.getPanes().overlayPane.appendChild(this._el);\n\n      if (!this._heatmap) {\n        this._heatmap = h337.create(this.cfg);\n      } \n\n      // this resets the origin and redraws whenever\n      // the zoom changed or the map has been moved\n      map.on('moveend', this._reset, this);\n      this._draw();\n    },\n\n    addTo: function (map) {\n      map.addLayer(this);\n      return this;\n    },\n\n    onRemove: function (map) {\n      // remove layer's DOM elements and listeners\n      map.getPanes().overlayPane.removeChild(this._el);\n\n      map.off('moveend', this._reset, this);\n    },\n    _draw: function() {\n      if (!this._map) { return; }\n      \n      var mapPane = this._map.getPanes().mapPane;\n      var point = mapPane._leaflet_pos;      \n\n      // reposition the layer\n      this._el.style[HeatmapOverlay.CSS_TRANSFORM] = 'translate(' +\n        -Math.round(point.x) + 'px,' +\n        -Math.round(point.y) + 'px)';\n\n      this._update();\n    },\n    _update: function() {\n      var bounds, zoom, scale;\n      var generatedData = { max: this._max, min: this._min, data: [] };\n\n      bounds = this._map.getBounds();\n      zoom = this._map.getZoom();\n      scale = Math.pow(2, zoom);\n\n      if (this._data.length == 0) {\n        if (this._heatmap) {\n          this._heatmap.setData(generatedData);\n        }\n        return;\n      }\n\n\n      var latLngPoints = [];\n      var radiusMultiplier = this.cfg.scaleRadius ? scale : 1;\n      var localMax = 0;\n      var localMin = 0;\n      var valueField = this.cfg.valueField;\n      var len = this._data.length;\n    \n      while (len--) {\n        var entry = this._data[len];\n        var value = entry[valueField];\n        var latlng = entry.latlng;\n\n\n        // we don't wanna render points that are not even on the map ;-)\n        if (!bounds.contains(latlng)) {\n          continue;\n        }\n        // local max is the maximum within current bounds\n        localMax = Math.max(value, localMax);\n        localMin = Math.min(value, localMin);\n\n        var point = this._map.latLngToContainerPoint(latlng);\n        var latlngPoint = { x: Math.round(point.x), y: Math.round(point.y) };\n        latlngPoint[valueField] = value;\n\n        var radius;\n\n        if (entry.radius) {\n          radius = entry.radius * radiusMultiplier;\n        } else {\n          radius = (this.cfg.radius || 2) * radiusMultiplier;\n        }\n        latlngPoint.radius = radius;\n        latLngPoints.push(latlngPoint);\n      }\n      if (this.cfg.useLocalExtrema) {\n        generatedData.max = localMax;\n        generatedData.min = localMin;\n      }\n\n      generatedData.data = latLngPoints;\n\n      this._heatmap.setData(generatedData);\n    },\n    setData: function(data) {\n      this._max = data.max || this._max;\n      this._min = data.min || this._min;\n      var latField = this.cfg.latField || 'lat';\n      var lngField = this.cfg.lngField || 'lng';\n      var valueField = this.cfg.valueField || 'value';\n    \n      // transform data to latlngs\n      var data = data.data;\n      var len = data.length;\n      var d = [];\n    \n      while (len--) {\n        var entry = data[len];\n        var latlng = new L.LatLng(entry[latField], entry[lngField]);\n        var dataObj = { latlng: latlng };\n        dataObj[valueField] = entry[valueField];\n        if (entry.radius) {\n          dataObj.radius = entry.radius;\n        }\n        d.push(dataObj);\n      }\n      this._data = d;\n    \n      this._draw();\n    },\n    // experimential... not ready.\n    addData: function(pointOrArray) {\n      if (pointOrArray.length > 0) {\n        var len = pointOrArray.length;\n        while(len--) {\n          this.addData(pointOrArray[len]);\n        }\n      } else {\n        var latField = this.cfg.latField || 'lat';\n        var lngField = this.cfg.lngField || 'lng';\n        var valueField = this.cfg.valueField || 'value';\n        var entry = pointOrArray;\n        var latlng = new L.LatLng(entry[latField], entry[lngField]);\n        var dataObj = { latlng: latlng };\n        \n        dataObj[valueField] = entry[valueField];\n        this._max = Math.max(this._max, dataObj[valueField]);\n        this._min = Math.min(this._min, dataObj[valueField]);\n\n        if (entry.radius) {\n          dataObj.radius = entry.radius;\n        }\n        this._data.push(dataObj);\n        this._draw();\n      }\n    },\n    _reset: function () {\n      this._origin = this._map.layerPointToLatLng(new L.Point(0, 0));\n      \n      var size = this._map.getSize();\n      if (this._width !== size.x || this._height !== size.y) {\n        this._width  = size.x;\n        this._height = size.y;\n\n        this._el.style.width = this._width + 'px';\n        this._el.style.height = this._height + 'px';\n\n        this._heatmap._renderer.setDimensions(this._width, this._height);\n      }\n      this._draw();\n    } \n  });\n\n  HeatmapOverlay.CSS_TRANSFORM = (function() {\n    var div = document.createElement('div');\n    var props = [\n      'transform',\n      'WebkitTransform',\n      'MozTransform',\n      'OTransform',\n      'msTransform'\n    ];\n\n    for (var i = 0; i < props.length; i++) {\n      var prop = props[i];\n      if (div.style[prop] !== undefined) {\n        return prop;\n      }\n    }\n    return props[0];\n  })();\n\n  return HeatmapOverlay;\n});"]}